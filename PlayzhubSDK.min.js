!function(){class e{constructor(){this.baseUrl="https://feature-api.playzhub.com",this.verifySessionApiURL="/verified-session",this.submitScoreApiURL="/save-game-session",this.getGameStateApiURL="/get-visitor-game-state",this.saveGameStateApiURL="/save-visitor-game-state",this.signingServiceUrl="https://feature-api.playzhub.com/sec/sign-request",this.listeners={},this.setupMessageListener()}getMobileOperatingSystem(){const e=navigator.userAgent||navigator.vendor||window.opera;return/android/i.test(e)?"Android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"iOS":"Browser"}sendMessageForAnalytics(e,t){const a=this.getMobileOperatingSystem(),s=JSON.stringify(t);switch(a){case"Android":try{window.postMessage({eventName:e,data:s},"*"),window.flutter_inappwebview?window.flutter_inappwebview.callHandler("playzhubsdk_event_handler",e,s):JSBridge[e](s)}catch(e){}break;case"iOS":try{window.postMessage({eventName:e,data:s},"*");const t={[e]:s};window.flutter_inappwebview?window.flutter_inappwebview.callHandler("playzhubsdk_event_handler",e,s):window.webkit.messageHandlers.jsHandler.postMessage(JSON.stringify(t))}catch(e){}break;case"Browser":try{window.postMessage({eventName:e,data:s},"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("playzhubsdk_event_handler",e,s)}catch(e){}break;default:try{window.postMessage({eventName:e,data:s},"*"),window.flutter_inappwebview&&window.flutter_inappwebview.callHandler("playzhubsdk_event_handler",e,s)}catch(e){}}}emitEvent(e,t){this.callApiAsPerEvent(e,t),this.sendMessageForAnalytics(e,t)}listen(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(e=>{try{const a="string"==typeof e?JSON.parse(e):e;t(a)}catch(e){}})}trigger(e,t){try{t="string"==typeof t?JSON.parse(t):t}catch(e){}this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}setupMessageListener(){window.addEventListener("message",e=>{const{eventName:t,data:a}=e.data||{};t&&this.listeners[t]&&this.trigger(t,a)})}getLaunchParams(){const e=new URLSearchParams(window.location.search),t={};for(const[a,s]of e.entries())t[a]=s;return JSON.stringify(t)}async getData(e,t={}){const a=t.method||"GET";let s=t.body||null;const i=t.headers instanceof Headers?Object.fromEntries(t.headers.entries()):t.headers||{};let n={},r=e;const o=e.startsWith("/advertisement");try{null!=s&&s instanceof FormData&&(s=null),o&&(r=e.replace("/advertisement/api",""));const t=JSON.stringify({clientId:"playzhub",method:a,path:o?r:e,body:s}),d=this.encrypt(t),c=await fetch(this.signingServiceUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payload:d})}),h=await c.json(),{clientId:p,timestamp:l,nonce:y,signature:w}=JSON.parse(this.decrypt(h.payload));n={"x-client-id":p,"x-timestamp":l,"x-nonce":y,"x-signature":w,...i}}catch(e){n={"x-client-id":"NIL","x-timestamp":"NIL","x-nonce":"NIL","x-signature":"NIL",...i}}try{const a=await fetch(this.baseUrl+""+e,{method:"GET",...t,headers:n}),s=await a.json();if([400,401,403,404,406].includes(a.status)||s.error)throw s;return s}catch(e){throw e}}getHeaders(e,t){const a=new Headers;return t&&a.append("Authorization",`Bearer ${t}`),e?"formdata"!==e&&a.append("Content-Type",e):a.append("Content-Type","application/json"),a}async verifyGameSessionId(e,t,a,s){try{const i=this.getHeaders("application/json",e),n={game_id:t,session_id:a,hash:s};return await this.getData(this.verifySessionApiURL,{method:"POST",headers:i,body:JSON.stringify(n)})}catch(e){}}async getGameState(e,t,a){try{const s=this.getHeaders("application/json",e),i={game_id:t,hash:a};return await this.getData(this.getGameStateApiURL,{method:"POST",headers:s,body:JSON.stringify(i)})}catch(e){}}async saveGameScore(e,t,a,s){try{const i=this.getHeaders("application/json",e),n={game_id:t,game_score:a,hash:s};return await this.getData(this.submitScoreApiURL,{method:"POST",headers:i,body:JSON.stringify(n)})}catch(e){}}async saveGameState(e,t,a,s){try{const i=this.getHeaders("application/json",e),n={game_id:t,game_state:a,hash:s};return await this.getData(this.saveGameStateApiURL,{method:"POST",headers:i,body:JSON.stringify(n)})}catch(e){}}async callApiAsPerEvent(e,t){const a=JSON.parse(this.getLaunchParams());switch(e){case"RequestGameState":await this.handleGameStateFetchApi(t,a);break;case"GameScoreUpdate":await this.handleGameScoreUpdateApi(t,a);break;case"GameStateUpdate":await this.handleSaveGameStateApi(t,a)}}async handleGameStateFetchApi(e,t){this.initializeKey(e.encKey,e.iv);const a=t.game_id,s=t.session_id,i=t.token,n=await this.verifyGameSessionId(i,a,s,e.session_verify_hash);if(!n||!n.is_verified||1!==n.status)return;const r=await this.getGameState(i,a,e.request_game_state_hash),o=r?.data?.game_state??null;this.sendMessageForAnalytics("ReceivedGameState",o)}async handleGameScoreUpdateApi(e,t){this.initializeKey(e.encKey,e.iv);const a=t.game_id,s=t.session_id,i=t.token,n=await this.verifyGameSessionId(i,a,s,e.session_verify_hash);if(!n||!n.is_verified||1!==n.status)return;await this.saveGameScore(i,a,e.score,e.score_hash)}async handleSaveGameStateApi(e,t){this.initializeKey(e.encKey,e.iv);const a=t.game_id,s=t.session_id,i=t.token,n=await this.verifyGameSessionId(i,a,s,e.session_verify_hash);if(!n||!n.is_verified||1!==n.status)return;await this.saveGameState(i,a,e.game_state,e.request_game_state_hash)}initializeKey(e,t){window.CryptoJS&&(this.key=CryptoJS.enc.Base64.parse(e),this.iv=CryptoJS.enc.Base64.parse(t))}encrypt(e){return this.key&&this.iv?CryptoJS.AES.encrypt(e,this.key,{iv:this.iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString():null}decrypt(e){return CryptoJS.AES.decrypt(e,this.key,{iv:this.iv,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7}).toString(CryptoJS.enc.Utf8)}}!async function(){await new Promise((e,t)=>{if(window.CryptoJS)return e();const a=document.createElement("script");a.src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js",a.onload=()=>{e()},a.onerror=t,document.head.appendChild(a)}),window.PlayzhubSDk=new e,window.dispatchEvent(new Event("PlayzhubSDKReady"))}()}();